# Todo App - 完全仕様書（AI再現用）

**プロジェクト名**: Todo App  
**バージョン**: 1.0.0  
**最終更新**: 2025年11月13日  
**ステータス**: ✅ Production Ready  
**テスト**: 106/106 通過 (100%)  
**デプロイURL**: https://j1921604.github.io/todo-app/  
**GitHubリポジトリ**: https://github.com/J1921604/todo-app

---

## 📋 目次

1. [プロジェクト概要](#プロジェクト概要)
2. [技術スタック](#技術スタック)
3. [プロジェクト構造](#プロジェクト構造)
4. [データモデル](#データモデル)
5. [コアモジュール仕様](#コアモジュール仕様)
6. [UIコンポーネント仕様](#uiコンポーネント仕様)
7. [機能仕様](#機能仕様)
8. [テスト仕様](#テスト仕様)
9. [デプロイ仕様](#デプロイ仕様)
10. [環境構築手順](#環境構築手順)
11. [開発ワークフロー](#開発ワークフロー)
12. [パフォーマンス要件](#パフォーマンス要件)
13. [セキュリティ要件](#セキュリティ要件)
14. [アクセシビリティ要件](#アクセシビリティ要件)

---

## プロジェクト概要

### 目的

React + TypeScriptによるモダンなTodoアプリケーションの実装を通じて、以下を実現：

1. **教育**: React開発の実践的な学習
2. **デモ**: 個人用タスク管理ツールの提供
3. **テンプレート**: 他プロジェクトへの応用可能なアーキテクチャ

### 主要機能

- ✅ 個人用Todoページの動的作成
- ✅ タスクのCRUD操作（作成・読み取り・更新・削除）
- ✅ タスクフィルタリング（すべて/進行中/完了済み）
- ✅ LocalStorageによるデータ永続化
- ✅ ページ管理（追加・編集・削除）
- ✅ 完了タスクの一括削除
- ✅ 日本語完全対応
- ✅ レスポンシブUI
- ✅ ワンコマンド起動
- ✅ GitHub Pages自動デプロイ

### 憲法（開発原則）

**パフォーマンス要件**:
- PR-001: 初期ページ読み込み < 2秒
- PR-002: タスク操作レスポンス < 100ms
- PR-003: メモリ使用量 < 50MB
- PR-004: 10,000タスクでもフィルタリング < 1秒

**セキュリティ要件**:
- SR-001: XSS対策（React自動エスケープ）
- SR-002: LocalStorage容量制限チェック
- SR-003: 入力バリデーション（1-500文字）
- SR-004: エラーハンドリング（try-catch）
- SR-005: 機密情報マスキング

**アクセシビリティ要件**:
- AR-001: ARIA属性の適切な設定
- AR-002: キーボードナビゲーション対応
- AR-003: スクリーンリーダー対応
- AR-004: 適切なコントラスト比

**テスト要件**:
- TR-001: テストカバレッジ 100%
- TR-002: テスト実行時間 < 12秒
- TR-003: すべてのユーザーストーリーに統合テスト
- TR-004: エッジケースのテスト

---

## 技術スタック

### フロントエンド

```json
{
  "framework": "React 18.2.0",
  "language": "TypeScript 4.9.3",
  "router": "React Router DOM 6.10.0",
  "buildTool": "Vite 4.2.0"
}
```

### テスト

```json
{
  "testFramework": "Vitest 0.34.0",
  "testLibrary": "@testing-library/react 14.1.2",
  "testEnvironment": "happy-dom 12.10.3"
}
```

### データ永続化

- **LocalStorage API**: クライアントサイドデータストレージ
- **JSON形式**: データシリアライゼーション

### デプロイ

- **GitHub Pages**: 静的サイトホスティング
- **GitHub Actions**: CI/CDパイプライン

---

## プロジェクト構造

```
todo-app/
├── .github/
│   └── workflows/
│       └── deploy.yml                 # GitHub Actionsデプロイワークフロー
├── src/
│   ├── App.tsx                        # メインアプリケーションコンポーネント
│   ├── main.tsx                       # エントリーポイント
│   ├── index.css                      # グローバルスタイル
│   ├── vite-env.d.ts                  # Vite型定義
│   ├── components/
│   │   ├── atoms/                     # Atomic Designパターン
│   │   │   ├── Button/
│   │   │   │   ├── index.tsx          # Buttonエクスポート
│   │   │   │   ├── Middle.tsx         # 中サイズボタン
│   │   │   │   └── Small.tsx          # 小サイズボタン
│   │   │   └── Input/
│   │   │       ├── index.tsx          # Inputエクスポート
│   │   │       └── Text.tsx           # テキスト入力
│   │   └── organisms/
│   │       └── Sidebar.tsx            # サイドバー（ページ管理）
│   ├── config/
│   │   └── userPages.ts               # ユーザーページ設定
│   ├── pages/
│   │   ├── HomePage.tsx               # ホームページ
│   │   ├── TestUserTodo.tsx           # テストユーザーページ
│   │   └── DynamicTodoPage.tsx        # 動的Todoページ
│   ├── types/
│   │   └── todo.ts                    # 型定義
│   └── utils/
│       ├── localStorage.ts            # LocalStorage操作
│       └── performance.ts             # パフォーマンス測定
├── tests/
│   ├── setup.ts                       # テストセットアップ
│   ├── unit/                          # ユニットテスト
│   │   ├── components/
│   │   │   ├── App.test.tsx
│   │   │   ├── DynamicTodoPage.test.tsx
│   │   │   ├── HomePage.test.tsx
│   │   │   ├── Sidebar.test.tsx
│   │   │   ├── TaskInput.test.tsx
│   │   │   └── TaskItem.test.tsx
│   │   ├── config/
│   │   │   └── userPages.test.ts
│   │   ├── types/
│   │   │   └── todo.test.ts
│   │   └── utils/
│   │       ├── localStorage.test.ts
│   │       └── performance.test.ts
│   └── integration/                   # 統合テスト
│       ├── bulk-deletion.test.tsx
│       ├── data-persistence.test.tsx
│       ├── edge-cases.test.tsx
│       ├── personal-page-setup.test.tsx
│       ├── task-deletion.test.tsx
│       ├── task-filtering.test.tsx
│       └── task-operations.test.tsx
├── AI_input/                          # 入力ドキュメント
├── specs/                             # 仕様書
├── package.json                       # NPM設定
├── tsconfig.json                      # TypeScript設定
├── vite.config.ts                     # Vite設定
├── vitest.config.ts                   # Vitest設定
├── index.html                         # HTMLエントリーポイント
├── start.ps1                          # ワンコマンド起動スクリプト
├── README.md                          # プロジェクトREADME
└── GitHub Pagesデプロイ手順.md         # デプロイ手順書
```

---

## データモデル

### TodoItem

```typescript
interface TodoItem {
  /** ユニークな識別子（Date.now()で生成） */
  id: number
  
  /** タスクの内容（1-500文字） */
  text: string
  
  /** 完了状態フラグ */
  completed: boolean
  
  /** 作成日時（ISO 8601形式） */
  createdAt: string
}
```

**バリデーションルール**:
- `id`: 正の整数
- `text`: 1-500文字（trim後）
- `completed`: boolean
- `createdAt`: ISO 8601形式の有効な日時文字列

### FilterType

```typescript
type FilterType = 'all' | 'active' | 'completed'
```

- `all`: すべてのタスクを表示
- `active`: 未完了タスクのみ表示
- `completed`: 完了タスクのみ表示

### StorageKey

```typescript
type StorageKey = `${string}-todos`
```

**形式**: `{ページ名}-todos`  
**例**: `TestUser-todos`, `田中-todos`

### UserPageConfig

```typescript
interface UserPageConfig {
  /** ページ名 */
  name: string
  
  /** ルーティングパス */
  path: string
  
  /** コンポーネントパス */
  componentPath: string
  
  /** アイコン（オプション） */
  icon?: string
}
```

---

## コアモジュール仕様

### 1. src/types/todo.ts

**目的**: アプリケーション全体で使用する型定義とヘルパー関数

**エクスポート**:

```typescript
// 型定義
export interface TodoItem { /* ... */ }
export type FilterType = 'all' | 'active' | 'completed'
export type StorageKey = `${string}-todos`

// ヘルパー関数
export function validateTodoItem(item: any): item is TodoItem
export function filterTodos(todos: TodoItem[], filter: FilterType): TodoItem[]
export function generateStorageKey(name: string): StorageKey
export function sortTodosByDate(todos: TodoItem[], order: 'asc' | 'desc'): TodoItem[]
```

**実装例**:

```typescript
export function validateTodoItem(item: any): item is TodoItem {
  if (typeof item !== 'object' || item === null) return false;
  
  const todo = item as Record<string, unknown>;
  
  // id: 正の整数
  if (typeof todo.id !== 'number' || !Number.isInteger(todo.id) || todo.id <= 0) {
    return false;
  }
  
  // text: 1〜500文字（trim後）
  if (typeof todo.text !== 'string' || todo.text.trim().length === 0) {
    return false;
  }
  if (todo.text.length > 500) {
    return false;
  }
  
  // completed: boolean
  if (typeof todo.completed !== 'boolean') {
    return false;
  }
  
  // createdAt: ISO 8601形式の文字列
  if (typeof todo.createdAt !== 'string') {
    return false;
  }
  const date = new Date(todo.createdAt);
  if (isNaN(date.getTime())) {
    return false;
  }
  
  return true;
}

export function generateStorageKey(name: string): StorageKey {
  if (!name || name.trim() === '') {
    throw new Error('Page name cannot be empty')
  }
  
  // 日本語を含む任意の文字列をサポート
  const sanitized = name.trim()
  return `${sanitized}-todos`
}
```

---

### 2. src/utils/localStorage.ts

**目的**: LocalStorage操作の抽象化とエラーハンドリング

**エクスポート**:

```typescript
export function saveTodos(key: StorageKey, todos: TodoItem[]): void
export function loadTodos(key: StorageKey): TodoItem[]
export function clearTodos(key: StorageKey): void
export function checkStorageQuota(): boolean
```

**実装仕様**:

```typescript
export function saveTodos(key: StorageKey, todos: TodoItem[]): void {
  try {
    const serialized = JSON.stringify(todos)
    localStorage.setItem(key, serialized)
  } catch (error) {
    // 憲法SR-005: 機密情報マスキング
    console.error(`Failed to save todos to localStorage (key: ${key}):`, {
      error: error instanceof Error ? error.message : 'Unknown error',
      taskCount: todos.length
    })
  }
}

export function loadTodos(key: StorageKey): TodoItem[] {
  try {
    const saved = localStorage.getItem(key)
    if (!saved) {
      return []
    }

    const parsed = JSON.parse(saved)
    if (!Array.isArray(parsed)) {
      console.warn(`Invalid data format in localStorage (key: ${key})`)
      return []
    }

    return parsed
  } catch (error) {
    console.error(`Failed to load todos from localStorage (key: ${key}):`, {
      error: error instanceof Error ? error.message : 'Unknown error'
    })
    return []
  }
}
```

**エラーハンドリング**:
- JSON.parse失敗時: 空配列を返す
- QuotaExceededError: エラーログを出力
- データ破損: 空配列を返す

---

### 3. src/config/userPages.ts

**目的**: ユーザーページの設定管理

**エクスポート**:

```typescript
export interface UserPageConfig { /* ... */ }
export const userPages: UserPageConfig[]
export const getUserPages = (): UserPageConfig[]
export const addUserPage = (name: string, icon?: string): boolean
export const removeUserPage = (name: string): boolean
export const updateUserPage = (oldName: string, newName: string): boolean
```

**実装仕様**:

```typescript
export const addUserPage = (name: string, icon: string = '📝'): boolean => {
  try {
    // 空の名前をチェック
    if (!name || name.trim() === '') {
      console.error('ページ名は必須です')
      return false
    }
    
    // パス生成（日本語対応）
    const path = `/${name.toLowerCase()}-todo`
    const componentPath = `./pages/${name}Todo`
    
    // 既に存在するかチェック
    const exists = userPages.some(page => page.name === name || page.path === path)
    if (exists) {
      console.error(`ページ "${name}" は既に存在します`)
      return false
    }
    
    // 新しいページを追加
    userPages.push({ name, path, componentPath, icon })
    
    // LocalStorageに保存
    localStorage.setItem('userPages', JSON.stringify(userPages))
    
    // カスタムイベント発火
    window.dispatchEvent(new Event('userPagesUpdated'))
    
    return true
  } catch (error) {
    console.error('ページ追加エラー:', error)
    return false
  }
}

export const removeUserPage = (name: string): boolean => {
  try {
    const index = userPages.findIndex(page => page.name === name)
    if (index === -1) {
      console.error(`ページ "${name}" が見つかりません`)
      return false
    }
    
    // ページを削除
    userPages.splice(index, 1)
    
    // LocalStorageから削除
    localStorage.setItem('userPages', JSON.stringify(userPages))
    
    // タスクデータも削除
    const storageKey = generateStorageKey(name)
    localStorage.removeItem(storageKey)
    console.log(`タスクデータを削除しました: ${storageKey}`)
    
    // カスタムイベント発火
    window.dispatchEvent(new Event('userPagesUpdated'))
    
    return true
  } catch (error) {
    console.error('ページ削除エラー:', error)
    return false
  }
}
```

---

## UIコンポーネント仕様

### 1. src/components/atoms/Input/Text.tsx

**目的**: テキスト入力フィールド

**Props**:

```typescript
interface TextInputProps {
  value: string
  onChange: (value: string) => void
  placeholder?: string
  maxLength?: number
  disabled?: boolean
  ariaLabel?: string
}
```

**実装**:

```typescript
export const Text: React.FC<TextInputProps> = ({
  value,
  onChange,
  placeholder = '',
  maxLength = 500,
  disabled = false,
  ariaLabel
}) => {
  return (
    <input
      type="text"
      value={value}
      onChange={(e) => onChange(e.target.value)}
      placeholder={placeholder}
      maxLength={maxLength}
      disabled={disabled}
      aria-label={ariaLabel || placeholder}
      style={{
        width: '100%',
        padding: '10px',
        fontSize: '16px',
        border: '1px solid #ddd',
        borderRadius: '4px'
      }}
    />
  )
}
```

---

### 2. src/components/atoms/Button/Middle.tsx & Small.tsx

**目的**: 操作ボタン（サイズバリエーション）

**Props**:

```typescript
interface ButtonProps {
  onClick: () => void
  children: React.ReactNode
  disabled?: boolean
  style?: React.CSSProperties
  ariaLabel?: string
}
```

**実装（Middle.tsx）**:

```typescript
export const Middle: React.FC<ButtonProps> = ({
  onClick,
  children,
  disabled = false,
  style,
  ariaLabel
}) => {
  return (
    <button
      onClick={onClick}
      disabled={disabled}
      aria-label={ariaLabel}
      style={{
        padding: '10px 20px',
        fontSize: '16px',
        backgroundColor: '#007bff',
        color: 'white',
        border: 'none',
        borderRadius: '4px',
        cursor: disabled ? 'not-allowed' : 'pointer',
        opacity: disabled ? 0.6 : 1,
        ...style
      }}
    >
      {children}
    </button>
  )
}
```

---

### 3. src/components/organisms/Sidebar.tsx

**目的**: サイドバーナビゲーション＋ページ管理

**状態管理**:

```typescript
const [showAddForm, setShowAddForm] = useState(false)
const [newPageName, setNewPageName] = useState('')
const [editingPage, setEditingPage] = useState<string | null>(null)
const [editName, setEditName] = useState('')
const [pages, setPages] = useState<UserPageConfig[]>(getInitialPages())
```

**主要機能**:

1. **ページ追加**:
   - UIモーダル表示
   - 名前とアイコン入力
   - addUserPage() 呼び出し
   - サーバー再起動通知

2. **ページ編集**:
   - インライン編集UI
   - updateUserPage() 呼び出し
   - サーバー再起動通知

3. **ページ削除**:
   - 確認ダイアログ表示
   - removeUserPage() 呼び出し
   - タスクデータ削除
   - ホームにリダイレクト

**実装サンプル**:

```typescript
const handleAddPage = () => {
  if (!newPageName.trim()) {
    alert('名前を入力してください')
    return
  }
  
  const pageName = newPageName.trim()
  const success = addUserPage(pageName, '📝')
  if (success) {
    const newPath = `/${pageName.toLowerCase()}-todo`
    setNewPageName('')
    setShowAddForm(false)
    
    setTimeout(() => {
      navigate(newPath)
    }, 100)
  } else {
    alert('ページの追加に失敗しました')
  }
}

const handleDeletePage = (name: string, path: string) => {
  if (window.confirm(`${name}のページを削除しますか？`)) {
    const success = removeUserPage(name)
    if (success) {
      if (location.pathname === path) {
        navigate('/')
      }
      alert(`${name}のページを削除しました！\n\nページを削除するには、開発サーバーを再起動してください：\n1. Ctrl+C でサーバーを停止\n2. npm run dev で再起動`)
    } else {
      alert('ページの削除に失敗しました')
    }
  }
}
```

---

### 4. src/pages/DynamicTodoPage.tsx

**目的**: 動的に生成されるTodoページ

**Props**:

```typescript
interface DynamicTodoPageProps {
  userName: string
}
```

**状態管理**:

```typescript
const [todos, setTodos] = useState<TodoItem[]>([])
const [inputText, setInputText] = useState('')
const [filter, setFilter] = useState<FilterType>('all')
const [error, setError] = useState<string | null>(null)
const [isLoaded, setIsLoaded] = useState(false)
```

**ライフサイクル**:

```typescript
// LocalStorageから読み込み
useEffect(() => {
  const savedTodos = localStorage.getItem(STORAGE_KEY)
  if (savedTodos) {
    try {
      const parsedTodos = JSON.parse(savedTodos)
      setTodos(parsedTodos)
    } catch (error) {
      console.error('Failed to load todos from localStorage:', error)
    }
  }
  setIsLoaded(true)
}, [STORAGE_KEY])

// LocalStorageに保存
useEffect(() => {
  if (!isLoaded) return
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(todos))
  } catch (error) {
    console.error('Failed to save todos to localStorage:', error)
  }
}, [todos, STORAGE_KEY, isLoaded])
```

**主要機能**:

1. **タスク追加**:
```typescript
const addTodo = () => {
  if (!inputText.trim()) return

  const newTodo: TodoItem = {
    id: Date.now(),
    text: inputText.trim(),
    completed: false,
    createdAt: new Date().toISOString(),
  }

  setTodos((prev) => [...prev, newTodo])
  setInputText('')
}
```

2. **完了切り替え**:
```typescript
const toggleTodo = (id: number) => {
  setTodos((prev) =>
    prev.map((todo) =>
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    )
  )
}
```

3. **個別削除**:
```typescript
const deleteTodo = (id: number) => {
  setTodos((prev) => prev.filter((todo) => todo.id !== id))
}
```

4. **一括削除**:
```typescript
const clearCompleted = () => {
  setTodos((prev) => prev.filter((todo) => !todo.completed))
}
```

5. **フィルタリング**:
```typescript
const filteredTodos = todos.filter((todo) => {
  switch (filter) {
    case 'active':
      return !todo.completed
    case 'completed':
      return todo.completed
    default:
      return true
  }
})
```

---

## 機能仕様

### ユーザーストーリー1: 個人用Todoページの作成と基本操作

**優先度**: P1 (MVP)

**受入基準**:

1. サイドバーの「➕ 新規ページ追加」ボタンで新規ページを作成できる
2. 名前とアイコンを入力してページを追加できる
3. サーバー再起動後、追加したページがサイドバーに表示される
4. タスクを追加できる（入力フィールド + 追加ボタン）
5. タスクの完了状態を切り替えられる（チェックボックス）
6. フィルターでタスクを絞り込める（すべて/進行中/完了済み）
7. ページをリロードしてもデータが保持される（LocalStorage）

**実装済み**: ✅

---

### ユーザーストーリー2: タスク削除機能

**優先度**: P2

**受入基準**:

1. 各タスクに削除ボタンが表示される
2. 削除ボタンをクリックすると対象タスクが削除される
3. 完了タスクがある場合、「完了済みをクリア」ボタンが表示される
4. 「完了済みをクリア」ボタンで完了タスクを一括削除できる
5. 削除後、UIとLocalStorageが即時更新される

**実装済み**: ✅

---

### ユーザーストーリー3: ページ管理機能

**優先度**: P3

**受入基準**:

1. サイドバーの各ページに編集ボタンが表示される
2. 編集ボタンでページ名を変更できる
3. サイドバーの各ページに削除ボタンが表示される
4. 削除ボタンでページとタスクデータを完全に削除できる
5. ページ削除時、確認ダイアログが表示される
6. ページ削除後、ホームにリダイレクトされる

**実装済み**: ✅

---

### ユーザーストーリー4: ワンコマンド起動とデプロイ

**優先度**: P1 (MVP)

**受入基準**:

1. `.\start.ps1` でワンコマンド起動できる
   - 依存関係の自動インストール
   - サーバー起動
   - ブラウザ自動起動
   - PowerShell自動終了
2. `npm run build` でプロダクションビルドできる
3. `npm run deploy` でGitHub Pagesにデプロイできる（手動）
4. GitHub Actionsで自動デプロイできる（main/deployブランチプッシュ時）

**実装済み**: ✅

---

## テスト仕様

### テスト構成

**総テスト数**: 106  
**カバレッジ目標**: 100%  
**実行時間**: < 12秒

### ユニットテスト（18テスト）

1. **tests/unit/types/todo.test.ts** (17テスト)
   - TodoItem型のバリデーション
   - FilterType型の動作
   - generateStorageKey関数
   - filterTodos関数
   - sortTodosByDate関数

2. **tests/unit/utils/localStorage.test.ts** (9テスト)
   - saveTodos関数
   - loadTodos関数
   - clearTodos関数
   - エラーハンドリング

3. **tests/unit/utils/performance.test.ts** (6テスト)
   - measurePerformance関数
   - measurePerformanceSync関数
   - パフォーマンス閾値チェック

4. **tests/unit/config/userPages.test.ts** (12テスト)
   - getUserPages関数
   - addUserPage関数
   - removeUserPage関数
   - updateUserPage関数
   - エッジケース

5. **tests/unit/components/App.test.tsx** (4テスト)
   - App コンポーネントのレンダリング
   - ルーティング設定
   - ユーザーページの動的ロード
   - エラーハンドリング

6. **tests/unit/components/DynamicTodoPage.test.tsx** (8テスト)
   - タスク追加
   - タスク完了切り替え
   - タスク削除
   - フィルタリング

7. **tests/unit/components/HomePage.test.tsx** (3テスト)
   - ホームページのレンダリング
   - ウェルカムメッセージ
   - ナビゲーションリンク

8. **tests/unit/components/Sidebar.test.tsx** (8テスト)
   - サイドバーのレンダリング
   - ページ追加
   - ページ編集
   - ページ削除

9. **tests/unit/components/TaskInput.test.tsx** (5テスト)
   - 入力フィールドのレンダリング
   - テキスト入力
   - Enterキー押下
   - 最大文字数制限

10. **tests/unit/components/TaskItem.test.tsx** (4テスト)
    - タスクアイテムのレンダリング
    - 完了状態の表示
    - チェックボックスの動作
    - 削除ボタンの動作

### 統合テスト（7テスト）

1. **tests/integration/task-operations.test.tsx** (6テスト)
   - タスクCRUD操作の統合フロー
   - 複数タスクの同時操作

2. **tests/integration/data-persistence.test.tsx** (4テスト)
   - LocalStorageへの保存
   - ページリロード後の復元
   - 複数ページのデータ分離

3. **tests/integration/task-filtering.test.tsx** (4テスト)
   - フィルター切り替え
   - フィルター後のタスク数カウント

4. **tests/integration/task-deletion.test.tsx** (3テスト)
   - 個別削除の動作
   - 削除後のLocalStorage更新

5. **tests/integration/bulk-deletion.test.tsx** (3テスト)
   - 完了タスクの一括削除
   - 未完了タスクの保持

6. **tests/integration/personal-page-setup.test.tsx** (3テスト)
   - ページ追加フロー
   - ページ削除フロー
   - データクリーンアップ

7. **tests/integration/edge-cases.test.tsx** (7テスト)
   - 空文字列入力
   - 重複ページ名
   - LocalStorage容量超過
   - 日本語文字化け対策

### テスト実行コマンド

```powershell
# 全テスト実行
npm test -- --run

# ウォッチモード
npm test

# カバレッジレポート
npm run test:coverage

# 特定のテストファイル実行
npm test tests/unit/types/todo.test.ts
```

---

## デプロイ仕様

### GitHub Actions ワークフロー

**ファイル**: `.github/workflows/deploy.yml`

**トリガー**:
- `main` ブランチへのプッシュ
- `deploy` ブランチへのプッシュ
- 手動実行（workflow_dispatch）

**ジョブフロー**:

```yaml
jobs:
  build:
    - Checkout コード
    - Node.js 18 セットアップ
    - 依存関係インストール (npm ci)
    - テスト実行 (npm test -- --run)
    - ビルド実行 (npm run build)
    - 成果物アップロード (dist/)
  
  deploy:
    - GitHub Pagesへデプロイ
    - デプロイURL: https://j1921604.github.io/todo-app/
```

**権限**:

```yaml
permissions:
  contents: read
  pages: write
  id-token: write
```

### Vite設定

**ファイル**: `vite.config.ts`

```typescript
export default defineConfig({
  base: process.env.NODE_ENV === 'production' ? '/todo-app/' : '/',
  plugins: [react()],
  server: {
    port: 1234
  }
})
```

**ポイント**:
- 本番環境: `/todo-app/` (GitHub Pagesサブパス)
- 開発環境: `/` (ローカルホスト)

---

## 環境構築手順

### 前提条件

- Node.js 18以上
- npm 9以上
- Git
- PowerShell（Windows）またはbash（Mac/Linux）

### 初回セットアップ

```powershell
# リポジトリをクローン
git clone https://github.com/J1921604/todo-app.git
cd todo-app

# 依存関係をインストール
npm install

# 環境変数設定（必要に応じて）
# なし（LocalStorageのみ使用）

# 開発サーバー起動
npm run dev

# ブラウザで確認
# http://localhost:1234
```

### ワンコマンド起動

```powershell
# Windowsの場合
.\start.ps1

# Mac/Linuxの場合
npm run dev
```

**start.ps1の動作**:
1. node_modules存在チェック
2. 未インストールの場合、npm install実行
3. 開発サーバーをバックグラウンドで起動
4. サーバー起動確認（最大30秒待機）
5. ブラウザで http://localhost:1234 を自動起動
6. 5秒後にPowerShellウィンドウを自動終了

**サーバー停止方法**:

```powershell
# Windowsの場合
taskkill /F /IM node.exe

# Mac/Linuxの場合
pkill -f "vite"
```

---

## 開発ワークフロー

### 推奨開発フロー

```mermaid
flowchart LR
    A[機能仕様確認] --> B[テスト作成]
    B --> C[テスト実行<br/>失敗確認]
    C --> D[実装]
    D --> E[テスト実行<br/>成功確認]
    E --> F[リファクタリング]
    F --> G[コミット]
    G --> H{次の機能?}
    H -->|あり| A
    H -->|なし| I[プルリクエスト]
```

### ブランチ戦略

- `main`: 本番環境（自動デプロイ）
- `deploy`: デプロイテスト用（自動デプロイ）
- `feature/*`: 機能開発用（デプロイなし）
- `fix/*`: バグ修正用（デプロイなし）

### コミットメッセージ規約

```
<type>(<scope>): <subject>

<body>

<footer>
```

**Type**:
- `feat`: 新機能
- `fix`: バグ修正
- `docs`: ドキュメント
- `style`: コードスタイル
- `refactor`: リファクタリング
- `test`: テスト
- `chore`: その他

**例**:

```
feat(todo): タスク削除機能を追加

- 個別削除ボタンを追加
- 完了タスク一括削除ボタンを追加
- LocalStorageからの削除処理を実装

Closes #42
```

---

## パフォーマンス要件

### 測定基準

| 項目 | 目標 | 測定方法 |
|------|------|---------|
| 初期ページ読み込み | < 2秒 | Lighthouse Performance |
| タスク追加操作 | < 100ms | Performance API |
| タスク削除操作 | < 100ms | Performance API |
| 完了切り替え | < 50ms | Performance API |
| フィルタリング（10,000タスク） | < 1秒 | Performance API |
| LocalStorage読み書き | < 50ms | Performance API |
| メモリ使用量 | < 50MB | Chrome DevTools Memory |

### 最適化手法

1. **React.memo**: 不要な再レンダリング防止
2. **useMemo**: 計算結果のキャッシュ
3. **useCallback**: 関数の再生成防止
4. **仮想化リスト**: 大量タスクの効率的表示
5. **debounce**: LocalStorage書き込み頻度削減

---

## セキュリティ要件

### XSS対策

- React自動エスケープ（dangerouslySetInnerHTML不使用）
- ユーザー入力のバリデーション（1-500文字）
- サニタイゼーション（trim、特殊文字チェック）

### LocalStorage保護

- 容量制限チェック（5MB）
- エラーハンドリング（QuotaExceededError）
- データバリデーション（読み込み時）

### エラーハンドリング

- try-catch によるエラー捕捉
- エラーメッセージのマスキング（憲法SR-005）
- フォールバック処理（空配列返却など）

---

## アクセシビリティ要件

### ARIA属性

- `aria-label`: ボタン、入力フィールドに付与
- `role`: 適切なロールを設定
- `aria-live`: 動的コンテンツの変更通知

### キーボードナビゲーション

- Tab: フォーカス移動
- Enter: タスク追加
- Space: チェックボックス切り替え
- Escape: モーダル閉じる

### スクリーンリーダー対応

- 意味のある代替テキスト
- フォーカス管理
- 状態変更の通知

### コントラスト比

- WCAG 2.1 AA準拠
- 最小コントラスト比 4.5:1

---

## まとめ

この仕様書は、Todo Appの完全な再現に必要なすべての情報を含んでいます。

**実装完了項目**:
- ✅ 106テスト（100%通過）
- ✅ すべてのユーザーストーリー実装
- ✅ GitHub Actionsワークフロー
- ✅ ワンコマンド起動スクリプト
- ✅ LocalStorageデータ永続化
- ✅ レスポンシブUI
- ✅ 日本語完全対応

**デプロイ状況**:
- ✅ ビルド成功
- ✅ テストすべて通過
- ✅ GitHub Actions設定完了

**次のステップ**:
1. GitHubにプッシュ
2. GitHub Actions自動デプロイ
3. GitHub Pages設定確認
4. デプロイURL動作確認

---

**作成者**: GitHub Copilot  
**バージョン**: 1.0.0  
**最終更新**: 2025年11月13日
